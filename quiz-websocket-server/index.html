<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Event Broadcasting</title>
    <!-- Load Socket.IO client library -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script>
        const socket = io(); // Initialize the socket connection

        async function quiz() {
            let code = $('#code').val();
            const response = await fetch(`http://localhost/sami/public/api/events/get-questions?code=${code}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const result = await response.json();

            if(result.response.data != undefined) {
                $('#question').html(`Question: ${result.response.data.question}`);
                $('#answer_a').html(`A: ${result.response.data.answer_a}`);
                $('#answer_b').html(`B: ${result.response.data.answer_b}`);
                $('#answer_c').html(`C: ${result.response.data.answer_c}`);
                $('#answer_d').html(`D: ${result.response.data.answer_d}`);
                $('.quiz-container').show();
            }
            console.log(result.response.data);

            socket.emit('quiz', result);
        }

        async function updateStatus() {
            const response = await fetch('http://localhost/sami/public/api/events/update-status?quiz_id=2', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const result = await response.json();
            console.log(result);
        }

        async function submitCode() {
            let code = $('#code').val();
            const response = await fetch(`http://localhost/sami/public/api/events/get-quiz?code=${code}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const result = await response.json();
            if(result.response.data.quiz != undefined) {
                $('#code').hide();
                $('#submitCode').hide();
                $('#startQuiz').show();
                $('#updateStatus').show();
                $('#nextQuestion').show();
            }
            console.log(result.response.data.quiz);
        }

        // Listen for events broadcasted from the server
        socket.on('quiz', () => {
            console.log('Quiz has started!');
        });
    </script>
</head>
<body>
    <h1>Quiz Control</h1>
    <input id="code" type="text" name="code" id="code">
    <button id="submitCode" onclick="submitCode()">Submit Code</button>
    <button style="display: none;" id="startQuiz" onclick="quiz()">Start Quiz</button>
    <button style="display: none;" id="updateStatus" onclick="updateStatus()">Update Status</button>
    <button style="display: none;" id="nextQuestion" onclick="quiz()">Next Question</button>
    <div class="quiz-container" style="display: none;">
        <h2 id="question">Question: What is the capital of France?</h2>
        <ul>
            <li id="answer_a"></li>
            <li id="answer_b"></li>
            <li id="answer_c"></li>
            <li id="answer_d"></li>
        </ul>
    </div>
</body>
</html>
